{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://github.com/haje01/loglab/flow.schema.json",
    "title": "Flow",
    "description": "Loglab flow file",
    "type": "object",
    "$defs": {
        "events": {
            "enum": [
                {% for event in events %}
                "{{ event }}"{% if not loop.last %},{% endif %}
                {% endfor %}
            ]
        },
        "fields": {
            "enum": [
                {% for field in fields %}
                "{{ field }}"{% if not loop.last %},{% endif %}
                {% endfor %}
            ]
        },
        "step-body": {
            "type": "array",
            "items": {
                "anyOf": [
                    {"$ref": "#/$defs/events"},
                    {"$ref": "#/$defs/spawn-body"},
                    {"$ref": "#/$defs/sample-body"}
                ]
            }
        },
        "spawn-body": {
            "type": "object",
            "properties": {
                "spawn_by": {"$ref": "#/$defs/by-body"},
                "repeat": {"type": "integer"},
                "steps": {"$ref": "#/$defs/step-body"}
            }
        },
        "spawn-weight": {
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "weight": {"type": "integer"}
                    },
                    "required": ["weight"]
                },
                {"$ref": "#/$defs/spawn-body"}
            ]
        },
        "sample-weight": {
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "weight": {"type": "integer"}
                    },
                    "required": ["weight"]
                },
                {"$ref": "#/$defs/sample-body"}
            ]
        },
        "sample-body": {
            "type": "array",
            "items": {
                "anyOf": [
                    {"$ref": "#/$defs/spawn-weight"},
                    {"$ref": "#/$defs/sample-weight"}
                ]
            }
        },
        "datetime-type": {
            "type": "string",
            "pattern": "^([0-9]+)-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])( ([01][0-9]|2[0-3]))?$"
        },
        "datetime-body": {
            "type": "object",
            "properties": {
                "start": { "$ref": "#/$defs/datetime-type"},
                "tzoffset": {
                    "type": "string",
                    "pattern": "[\\\\+|\\\\-]([01][0-9]|2[0-3]):[0-5][0-9]"
                },
                "speed": {"type": "number"}
            }
        },
        "by-body": {
            "type": "array",
            "items": [
                {"$ref": "#/$defs/fields"},
                {
                    "anyOf": [
                        {
                            "type": "array",
                            "items": {
                                "type": "number"
                            }
                        },
                        {
                            "type": "array",
                            "items": {
                                "type": "integer"
                            }
                        },
                        {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }    
                    ]
                }
            ]
        }
    },
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Schema URI"
        },
        "labfile": {
            "const": "{{ labfile }}",
            "description": "랩파일 경로"
        },
        "flow": {
            "oneOf": [
                {"$ref": "#/$defs/spawn-body"},
                {"$ref": "#/$defs/sample-body"}
            ]
        },
        "datetime": {"$ref": "#/$defs/datetime-body"},
        "file_by": {"$ref": "#/$defs/by-body"},
        "file_ptrn": {"type": "string"}
    },
    "required": ["flow"],
    "additionalProperties": false
}